{"version":3,"file":"20220804-formapp-3dde7cda2cece1876969.js","mappings":"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","sources":["webpack://care-ops-frontend/./src/js/formapp/utils.js","webpack://care-ops-frontend/./src/js/formapp/components.js","webpack://care-ops-frontend/./src/js/formapp.js","webpack://care-ops-frontend/./src/js/regions/preload_region.js"],"sourcesContent":["/* global Formio, FormioUtils */\nimport { extend, reduce } from 'underscore';\n\n// Note: Allows for setting the submission at form instantiation\n// https://github.com/formio/formio.js/pull/4580\nconst webformInit = Formio.Displays.displays.webform.prototype.init;\n\nFormio.Displays.displays.webform.prototype.init = function() {\n  if (this.options.data) {\n    const data = extend({}, this.options.data);\n    this._submission = { data };\n    this._data = data;\n  }\n  webformInit.call(this);\n};\n\n// NOTE: Evaluator should throw errors\n// https://github.com/formio/formio.js/issues/4613\nconst evaluator = Formio.Evaluator.evaluator;\nFormio.Evaluator.evaluator = function(func, ...params) {\n  try {\n    return evaluator(func, ...params);\n  } catch (e) {\n    /* eslint-disable-next-line no-console */\n    console.error(e);\n  }\n};\n\n// NOTE: Evaluate should also throw errors\nconst evaluate = Formio.Evaluator.evaluate;\nFormio.Evaluator.evaluate = function(func, ...params) {\n  try {\n    return evaluate(func, ...params);\n  } catch (e) {\n    /* eslint-disable-next-line no-console */\n    console.error(e);\n  }\n};\n\nfunction getScriptContext(contextScripts, baseContext) {\n  return Formio.createForm(document.createElement('div'), {}).then(form => {\n    const context = reduce(contextScripts, (memo, script) => {\n      return extend({}, memo, FormioUtils.evaluate(script, form.evalContext(memo)));\n    }, baseContext);\n\n    form.destroy();\n\n    return context;\n  });\n}\n\nfunction getSubmission(formData, formSubmission, reducers, evalContext) {\n  return Formio.createForm(document.createElement('div'), {}, { evalContext }).then(form => {\n    const submission = reduce(reducers, (memo, reducer) => {\n      return FormioUtils.evaluate(reducer, form.evalContext({ formSubmission: memo, formData })) || memo;\n    }, formSubmission);\n\n    form.destroy();\n\n    return submission;\n  });\n}\n\nconst hasChangedFunction = 'return function hasChanged(key) { return !_.isEqual(_.get(formSubmission, key), _.get(prevSubmission, key)); }';\n\nfunction getChangeReducers(form, changeReducers, curSubmission, prevSubmission) {\n  return reduce(changeReducers, (memo, reducer) => {\n    const context = form.evalContext({ formSubmission: memo, prevSubmission });\n    context.hasChanged = FormioUtils.evaluate(hasChangedFunction, context);\n    return FormioUtils.evaluate(reducer, context) || memo;\n  }, curSubmission);\n}\n\nexport {\n  getScriptContext,\n  getSubmission,\n  getChangeReducers,\n};\n","/* global Formio */\nimport { debounce } from 'underscore';\nconst NestedComponent = Formio.Components.components.nested;\nconst SelectComponent = Formio.Components.components.select;\n\nclass SnippetComponent extends NestedComponent {\n  constructor(...args) {\n    super(...args);\n    this.noField = true;\n  }\n  static schema(...extendArgs) {\n    return NestedComponent.schema({\n      label: 'Snippet',\n      key: 'snippet',\n      type: 'snippet',\n      components: [],\n      input: false,\n      persistent: false,\n      snippet: null,\n    }, ...extendArgs);\n  }\n}\n\n// NOTE: Outside of the schema much of the logic is slightly modified from SelectComponent\nclass DirectoryComponent extends SelectComponent {\n  static schema(...extend) {\n    return SelectComponent.schema({\n      label: 'Directory',\n      key: 'directory',\n      type: 'directory',\n      dataSrc: 'custom',\n      searchField: true,\n      customOptions: {\n        noChoicesText: 'Type a minimum of 3 characters for results',\n      },\n    }, ...extend);\n  }\n\n  get defaultSchema() {\n    return DirectoryComponent.schema();\n  }\n\n  constructor(...args) {\n    super(...args);\n    this.updateCustomItems = debounce(this.updateCustomItems, 300);\n  }\n\n  updateItems(searchInput, forceUpdate) {\n    if (!this.visible) {\n      this.itemsLoadedResolve();\n      return;\n    }\n\n    this.updateCustomItems(forceUpdate, searchInput);\n  }\n\n  // NOTE: Biggest modification is exposing the searchInput to the custom code\n  getCustomItems(searchInput) {\n    if (!searchInput || searchInput.length < 3) return Promise.resolve([]);\n\n    return this.evaluate(this.component.data.custom, {\n      values: [],\n      searchInput,\n    }, 'values');\n  }\n\n  updateCustomItems(forceUpdate, searchInput) {\n    if (!forceUpdate && !this.active) {\n      this.itemsLoadedResolve();\n      return;\n    }\n\n    this.loading = true;\n    this.getCustomItems(searchInput)\n      .then(items => {\n        this.loading = false;\n        this.setItems(items || []);\n      })\n      .catch(err => {\n        this.handleLoadingError(err);\n      });\n  }\n}\n\nFormio.use({\n  components: {\n    snippet: SnippetComponent,\n    directory: DirectoryComponent,\n  },\n});\n","/* global Formio, FormioUtils */\nimport 'formiojs/dist/formio.form.min';\nimport 'formiojs/dist/formio.form.css';\nimport '@fortawesome/fontawesome-pro/scss/fontawesome.scss';\nimport '@fortawesome/fontawesome-pro/scss/v4-shims.scss';\nimport '@fortawesome/fontawesome-pro/scss/solid.scss';\nimport 'sass/formapp/bootstrap.min.css';\n\nimport 'sass/formapp-core.scss';\n\nimport { extend, map, debounce } from 'underscore';\nimport $ from 'jquery';\nimport Backbone from 'backbone';\nimport Handlebars from 'handlebars/runtime';\nimport parsePhoneNumber from 'libphonenumber-js/min';\n\nimport { versions } from './config';\n\nimport {\n  getScriptContext,\n  getSubmission,\n  getChangeReducers,\n} from 'js/formapp/utils';\n\nimport 'js/formapp/components';\n\nimport PreloadRegion from 'js/regions/preload_region';\n\nimport 'sass/formapp/comment.scss';\nimport 'sass/formapp/form.scss';\nimport 'sass/formapp/formio-overrides.scss';\nimport 'sass/formapp/print.scss';\nimport 'sass/formapp/pdf.scss';\n\nlet router;\n\nfunction scrollTop() {\n  window.scrollTo({ top: 0 });\n}\n\nfunction getDirectory(directoryName, query) {\n  return router.request('fetch:directory', { directoryName, query });\n}\n\nfunction getContext(contextScripts) {\n  return getScriptContext(contextScripts, { getDirectory, Handlebars, TEMPLATES: {}, parsePhoneNumber });\n}\n\nlet prevSubmission;\n\nconst onChange = function(form, changeReducers) {\n  const data = getChangeReducers(form, changeReducers, structuredClone(form.submission.data), prevSubmission);\n\n  form.data = data;\n  form.setSubmission({ data }, { fromChangeReducers: true, fromSubmission: false });\n\n  prevSubmission = structuredClone(form.submission.data);\n};\n\nconst onChangeDebounce = debounce(onChange, 100);\n\nconst updateSubmision = debounce(function(submission) {\n  router.request('update:storedSubmission', submission);\n}, 2000);\n\nasync function renderForm({ definition, storedSubmission, formData, formSubmission, reducers, changeReducers, contextScripts, beforeSubmit }) {\n  const evalContext = await getContext(contextScripts);\n\n  const submission = storedSubmission || await getSubmission(formData, formSubmission, reducers, evalContext);\n  prevSubmission = structuredClone(submission);\n\n  const form = await Formio.createForm(document.getElementById('root'), definition, {\n    evalContext,\n    data: submission,\n    onChange({ fromChangeReducers }, { instance }) {\n      if (fromChangeReducers && form.initialized) return;\n\n      // Prevents clearing submission on add/edit of editgrid\n      if (instance && instance.inEditGrid) return;\n\n      updateSubmision(form.submission.data);\n\n      onChangeDebounce(form, changeReducers);\n    },\n  });\n\n  form.nosubmit = true;\n\n  router.off('form:submit');\n  router.off('form:errors');\n\n  router.on({\n    'form:errors'(errors) {\n      // NOTE: maps errors due to https://github.com/formio/formio.js/issues/3970\n      form.showErrors(map(errors, error => {\n        return { message: error };\n      }), true);\n    },\n    'form:submit'() {\n      form.setPristine(false);\n      if (!form.checkValidity(form.submission.data, true, form.submission.data)) return;\n\n      form.submit();\n    },\n  });\n\n  form.on('prevPage', scrollTop);\n  form.on('nextPage', scrollTop);\n\n  form.on('error', () => {\n    router.request('ready:form');\n  });\n\n  form.on('submit', response => {\n    // Always run one last change event on submit\n    onChangeDebounce.cancel();\n    onChange(form, changeReducers);\n    form.setPristine(false);\n    if (!form.checkValidity(response.data, true, response.data)) return;\n\n    const data = FormioUtils.evaluate(beforeSubmit, form.evalContext({ formSubmission: response.data }));\n    router.request('submit:form', { response: extend({}, response, { data }) });\n  });\n\n  router.request('ready:form');\n}\n\nasync function renderPreview({ definition, contextScripts }) {\n  const evalContext = await getContext(contextScripts);\n\n  extend(evalContext, { isPreview: true });\n\n  Formio.createForm(document.getElementById('root'), definition, { evalContext });\n}\n\nasync function renderResponse({ definition, formSubmission, contextScripts }) {\n  const evalContext = await getContext(contextScripts);\n\n  extend(evalContext, { isResponse: true });\n\n  Formio.createForm(document.getElementById('root'), definition, {\n    readOnly: true,\n    renderMode: 'form',\n    evalContext,\n    data: formSubmission,\n  }).then(form => {\n    form.on('prevPage', scrollTop);\n    form.on('nextPage', scrollTop);\n  });\n}\n\nasync function renderPdf({ definition, formData, formSubmission, reducers, contextScripts }) {\n  const evalContext = await getContext(contextScripts);\n\n  const submission = await getSubmission(formData, formSubmission, reducers, evalContext);\n\n  const form = await Formio.createForm(document.getElementById('root'), definition, {\n    evalContext,\n    data: submission,\n  });\n\n  form.nosubmit = true;\n}\n\nconst Router = Backbone.Router.extend({\n  initialize() {\n    window.addEventListener('message', ({ data, origin }) => {\n      /* istanbul ignore next: security check */\n      if (origin !== window.origin || !data || !data.message) return;\n\n      this.trigger(data.message, data.args);\n    }, false);\n\n    this.on('print:form', () => {\n      window.print();\n    });\n\n    this.request('version', versions.frontend);\n  },\n  request(message, args = {}) {\n    const request = new Promise(resolve => {\n      this.once(message, resolve);\n      parent.postMessage({ message, args }, window.origin);\n    });\n\n    return request;\n  },\n  routes: {\n    'formapp/': 'renderForm',\n    'formapp/preview': 'renderPreview',\n    'formapp/:id': 'renderResponse',\n    'formapp/pdf/:formId/:patientId(/:responseId)': 'renderPdf',\n  },\n  renderForm() {\n    this.request('fetch:form:data').then(renderForm);\n  },\n  renderPreview() {\n    this.request('fetch:form').then(renderPreview);\n  },\n  renderResponse(responseId) {\n    this.request('fetch:form:response', { responseId }).then(renderResponse);\n  },\n  renderPdf(formId, patientId, responseId) {\n    this.once('form:pdf', renderPdf);\n    $('body').append(`<iframe class=\"iframe-hidden\" src=\"/formservice/${ formId }/${ patientId }${ responseId ? `/${ responseId }` : '' }\"></iframe>`);\n  },\n});\n\nfunction startFormApp() {\n  const preloadRegion = new PreloadRegion({ el: '#root' });\n  preloadRegion.startPreloader();\n  router = new Router();\n  Backbone.history.start({ pushState: true });\n}\n\nexport {\n  startFormApp,\n};\n","import { range } from 'underscore';\nimport anime from 'animejs';\n\nimport hbs from 'handlebars-inline-precompile';\n\nimport { Region, View } from 'marionette';\n\nimport './preload.scss';\n\nconst SpinnerTemplate = hbs`\n  <div class=\"spinner-circle js-spinner\" style=\"opacity:0\">\n  {{#each dots}}<div class=\"spinner-child\"></div>{{/each}}\n  </div>\n  <p class=\"spinner-text js-loading\" style=\"opacity:0\">{{ @intl.regions.preload.loading }}</p>\n`;\n\nconst SpinnerView = View.extend({\n  className: 'spinner',\n  template: SpinnerTemplate,\n  ui: {\n    spinner: '.js-spinner',\n    loading: '.js-loading',\n  },\n  onRender() {\n    const timeout = this.getOption('timeout');\n\n    if (!timeout) {\n      this.showLoader(0, 300);\n      return;\n    }\n\n    this.showLoader(timeout / 2, timeout / 2 + 200);\n  },\n  showLoader(delay, duration) {\n    const anim = anime.timeline({\n      easing: 'easeInQuad',\n      delay,\n    });\n\n    anim\n      .add({\n        opacity: [0, 1],\n        targets: this.ui.spinner[0],\n        duration,\n      })\n      .add({\n        opacity: [0, 1],\n        targets: this.ui.loading[0],\n        duration: duration - 100,\n      }, 100);\n  },\n  templateContext: {\n    dots: range(12),\n  },\n});\n\nexport default Region.extend({\n  timeout: 500,\n  startPreloader() {\n    this.show(new SpinnerView({ timeout: this.getOption('timeout') }));\n  },\n});\n"],"names":["webformInit","Formio","Displays","displays","webform","prototype","init","this","options","data","extend","_submission","_data","call","evaluator","Evaluator","func","params","e","console","error","evaluate","getSubmission","formData","formSubmission","reducers","evalContext","createForm","document","createElement","then","form","submission","reduce","memo","reducer","FormioUtils","destroy","NestedComponent","Components","components","nested","SelectComponent","select","DirectoryComponent","schema","label","key","type","dataSrc","searchField","customOptions","noChoicesText","defaultSchema","constructor","super","updateCustomItems","debounce","updateItems","searchInput","forceUpdate","visible","itemsLoadedResolve","getCustomItems","length","Promise","resolve","component","custom","values","active","loading","items","setItems","catch","err","handleLoadingError","use","snippet","noField","extendArgs","input","persistent","directory","router","prevSubmission","scrollTop","window","scrollTo","top","getDirectory","directoryName","query","request","getContext","contextScripts","baseContext","context","script","getScriptContext","Handlebars","TEMPLATES","parsePhoneNumber","onChange","changeReducers","curSubmission","hasChanged","getChangeReducers","structuredClone","setSubmission","fromChangeReducers","fromSubmission","onChangeDebounce","updateSubmision","async","renderForm","definition","storedSubmission","beforeSubmit","getElementById","instance","initialized","inEditGrid","nosubmit","off","on","errors","showErrors","map","message","setPristine","checkValidity","submit","response","cancel","renderPreview","isPreview","renderResponse","isResponse","readOnly","renderMode","renderPdf","Router","Backbone","initialize","addEventListener","origin","trigger","args","print","versions","once","parent","postMessage","routes","responseId","formId","patientId","$","append","startFormApp","PreloadRegion","el","startPreloader","pushState","SpinnerTemplate","SpinnerView","View","className","template","ui","spinner","onRender","timeout","getOption","showLoader","delay","duration","anime","easing","add","opacity","targets","templateContext","dots","range","Region","show"],"sourceRoot":""}